<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 2: Finite Fields and Modular Arithmetic | Elementary Bitcoin</title>
    <meta name="description" content="Chapter 02: Finite Fields and Modular Arithmetic - Prime fields, extended Euclidean algorithm, Fermat's little theorem, multiplicative inverses">

    <!-- Open Graph -->
    <meta property="og:type" content="article">
    <meta property="og:site_name" content="Elementary Bitcoin">
    <meta property="og:title" content="Chapter 02: Finite Fields and Modular Arithmetic | Elementary Bitcoin">
    <meta property="og:description" content="Prime fields, extended Euclidean algorithm, Fermat's little theorem, multiplicative inverses">
    <meta property="og:url" content="https://elementarybitcoin.org/chapters/02-finite-fields.html">
    <meta property="og:image" content="https://elementarybitcoin.org/og-image.png">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Chapter 02: Finite Fields and Modular Arithmetic | Elementary Bitcoin">
    <meta name="twitter:description" content="Prime fields, extended Euclidean algorithm, Fermat's little theorem, multiplicative inverses">
    <meta name="twitter:image" content="https://elementarybitcoin.org/og-image.png">

    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <header class="chapter-header">
        <span class="chapter-number">Chapter Two</span>
        <h1 class="chapter-title">Finite Fields and Modular Arithmetic</h1>
        <p class="chapter-epigraph">
            "Mathematics is the queen of the sciences and number theory is the queen of mathematics."
            <br>&mdash; Carl Friedrich Gauss
        </p>
    </header>

    <main>
        <section>
            <p>
                In the previous chapter, we constructed the abstract framework of groups. Now we
                enrich this structure by introducing a second operation&mdash;multiplication&mdash;and
                demanding that both operations behave well together. This leads us to the concept
                of a <em>field</em>.
            </p>
            <p>
                For cryptography, we require fields with only finitely many elements. The arithmetic
                within these <em>finite fields</em> resembles clock arithmetic, yet possesses remarkable
                algebraic properties. It is in these finite worlds that elliptic curves shall live.
            </p>
        </section>

        <section>
            <h2>2.1 Modular Arithmetic: Clock Mathematics</h2>

            <p>
                Consider a 12-hour clock. When it shows 10 o'clock and three hours pass, the clock
                shows 1 o'clock&mdash;not 13. The numbers "wrap around" upon reaching 12. This
                wrapping behavior is the essence of modular arithmetic.
            </p>

            <div class="definition">
                <p class="definition-title">Definition 2.1 (Congruence)</p>
                <p>
                    Let <span class="math">n</span> be a positive integer. We say that integers
                    <span class="math">a</span> and <span class="math">b</span> are <strong>congruent
                    modulo n</strong>, written
                </p>
                <p style="text-align: center; font-size: 1.1em;">
                    <span class="math">a ‚â° b (mod n)</span>
                </p>
                <p>
                    if <span class="math">n</span> divides <span class="math">a ‚àí b</span>. Equivalently,
                    <span class="math">a</span> and <span class="math">b</span> have the same remainder
                    when divided by <span class="math">n</span>.
                </p>
            </div>

            <figure>
                <svg class="diagram" width="450" height="220" viewBox="0 0 450 220">
                    <!-- Number line -->
                    <line x1="20" y1="60" x2="430" y2="60" stroke="#666" stroke-width="2"/>

                    <!-- Tick marks and numbers -->
                    <g font-family="Georgia" font-size="12" text-anchor="middle">
                        <line x1="50" y1="55" x2="50" y2="65" stroke="#666" stroke-width="1"/>
                        <text x="50" y="80">0</text>
                        <circle cx="50" cy="60" r="4" fill="#4a90d9"/>

                        <line x1="100" y1="55" x2="100" y2="65" stroke="#666" stroke-width="1"/>
                        <text x="100" y="80">1</text>

                        <line x1="150" y1="55" x2="150" y2="65" stroke="#666" stroke-width="1"/>
                        <text x="150" y="80">2</text>

                        <line x1="200" y1="55" x2="200" y2="65" stroke="#666" stroke-width="1"/>
                        <text x="200" y="80">3</text>

                        <line x1="250" y1="55" x2="250" y2="65" stroke="#666" stroke-width="1"/>
                        <text x="250" y="80">4</text>

                        <line x1="300" y1="55" x2="300" y2="65" stroke="#666" stroke-width="1"/>
                        <text x="300" y="80">5</text>
                        <circle cx="300" cy="60" r="4" fill="#4a90d9"/>

                        <line x1="350" y1="55" x2="350" y2="65" stroke="#666" stroke-width="1"/>
                        <text x="350" y="80">6</text>

                        <line x1="400" y1="55" x2="400" y2="65" stroke="#666" stroke-width="1"/>
                        <text x="400" y="80">7</text>
                    </g>

                    <!-- Arrows showing wrapping -->
                    <path d="M 300 40 C 350 0, 400 0, 400 40" fill="none" stroke="#8b4513" stroke-width="1.5"/>
                    <path d="M 400 40 C 400 20, 430 10, 430 30" fill="none" stroke="#8b4513" stroke-width="1.5"/>
                    <path d="M 430 30 C 430 110, 20 110, 20 60" fill="none" stroke="#8b4513" stroke-width="1.5"/>
                    <path d="M 20 60 L 50 60" fill="none" stroke="#8b4513" stroke-width="1.5" marker-end="url(#arrowBrown)"/>

                    <!-- Labels -->
                    <text x="225" y="130" text-anchor="middle" font-family="Georgia" font-size="13" fill="#8b4513">5 + 2 wraps to 0 (mod 7)</text>

                    <!-- Result box -->
                    <rect x="140" y="160" width="170" height="40" rx="5" fill="#f8f5f0" stroke="#8b4513" stroke-width="1"/>
                    <text x="225" y="185" text-anchor="middle" font-family="Georgia" font-size="14">5 + 2 ‚â° 0 (mod 7)</text>

                    <defs>
                        <marker id="arrowBrown" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#8b4513"/>
                        </marker>
                    </defs>
                </svg>
                <figcaption>Figure 2.1: In modulo 7 arithmetic, adding 2 to 5 wraps around to 0.</figcaption>
            </figure>

            <div class="example">
                <p class="example-title">Example 2.1</p>
                <ul>
                    <li><span class="math">17 ‚â° 5 (mod 12)</span> since <span class="math">17 ‚àí 5 = 12</span> is divisible by 12.</li>
                    <li><span class="math">‚àí3 ‚â° 4 (mod 7)</span> since <span class="math">‚àí3 ‚àí 4 = ‚àí7</span> is divisible by 7.</li>
                    <li><span class="math">100 ‚â° 2 (mod 7)</span> since <span class="math">100 = 14 √ó 7 + 2</span>.</li>
                </ul>
            </div>

            <div class="theorem">
                <p class="theorem-title">Proposition 2.1 (Properties of Congruence)</p>
                <p>Congruence modulo <span class="math">n</span> is an equivalence relation:</p>
                <ol>
                    <li><em>Reflexive:</em> <span class="math">a ‚â° a (mod n)</span></li>
                    <li><em>Symmetric:</em> If <span class="math">a ‚â° b (mod n)</span>, then <span class="math">b ‚â° a (mod n)</span></li>
                    <li><em>Transitive:</em> If <span class="math">a ‚â° b (mod n)</span> and <span class="math">b ‚â° c (mod n)</span>, then <span class="math">a ‚â° c (mod n)</span></li>
                </ol>
            </div>

            <p>
                This equivalence relation partitions the integers into <span class="math">n</span>
                disjoint <em>residue classes</em>. We typically represent each class by its
                smallest nonnegative member.
            </p>

            <div class="definition">
                <p class="definition-title">Definition 2.2 (Residue Classes)</p>
                <p>
                    The set <span class="math">‚Ñ§‚Çô = {0, 1, 2, ..., n‚àí1}</span> denotes the
                    <strong>residue classes modulo n</strong>, also called the
                    <strong>integers modulo n</strong>.
                </p>
            </div>

            <div class="theorem">
                <p class="theorem-title">Proposition 2.2 (Modular Arithmetic Operations)</p>
                <p>
                    If <span class="math">a ‚â° a' (mod n)</span> and <span class="math">b ‚â° b' (mod n)</span>, then:
                </p>
                <ul>
                    <li><span class="math">a + b ‚â° a' + b' (mod n)</span></li>
                    <li><span class="math">a ‚àí b ‚â° a' ‚àí b' (mod n)</span></li>
                    <li><span class="math">a √ó b ‚â° a' √ó b' (mod n)</span></li>
                </ul>
            </div>

            <p>
                This proposition is the engine of modular arithmetic: we may freely replace any
                number with a congruent one without affecting the final residue. This allows us to
                keep numbers small throughout long calculations.
            </p>
        </section>

        <section>
            <h2>2.2 The Ring ‚Ñ§‚Çô</h2>

            <p>
                With addition and multiplication defined on residue classes, <span class="math">‚Ñ§‚Çô</span>
                acquires the structure of a <em>ring</em>.
            </p>

            <div class="definition">
                <p class="definition-title">Definition 2.3 (Ring)</p>
                <p>
                    A <strong>ring</strong> is a set <span class="math">R</span> equipped with two
                    binary operations, addition <span class="math">+</span> and multiplication <span class="math">√ó</span>,
                    satisfying:
                </p>
                <ol>
                    <li><span class="math">(R, +)</span> is an abelian group with identity <span class="math">0</span>.</li>
                    <li>Multiplication is associative: <span class="math">(a √ó b) √ó c = a √ó (b √ó c)</span>.</li>
                    <li>Multiplication distributes over addition:<br>
                        <span class="math">a √ó (b + c) = (a √ó b) + (a √ó c)</span><br>
                        <span class="math">(a + b) √ó c = (a √ó c) + (b √ó c)</span></li>
                </ol>
                <p>
                    If there exists an element <span class="math">1 ‚àà R</span> with <span class="math">1 √ó a = a √ó 1 = a</span>
                    for all <span class="math">a</span>, the ring is called a <strong>ring with unity</strong>.
                    If multiplication is commutative, it is a <strong>commutative ring</strong>.
                </p>
            </div>

            <div class="example">
                <p class="example-title">Example 2.2 (Arithmetic in ‚Ñ§‚Çá)</p>
                <p>In <span class="math">‚Ñ§‚Çá = {0, 1, 2, 3, 4, 5, 6}</span>:</p>
                <table>
                    <tr>
                        <th>+</th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th>
                    </tr>
                    <tr>
                        <th>0</th><td>0</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td>
                    </tr>
                    <tr>
                        <th>1</th><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>0</td>
                    </tr>
                    <tr>
                        <th>2</th><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>0</td><td>1</td>
                    </tr>
                    <tr>
                        <th>3</th><td>3</td><td>4</td><td>5</td><td>6</td><td>0</td><td>1</td><td>2</td>
                    </tr>
                    <tr>
                        <th>4</th><td>4</td><td>5</td><td>6</td><td>0</td><td>1</td><td>2</td><td>3</td>
                    </tr>
                    <tr>
                        <th>5</th><td>5</td><td>6</td><td>0</td><td>1</td><td>2</td><td>3</td><td>4</td>
                    </tr>
                    <tr>
                        <th>6</th><td>6</td><td>0</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td>
                    </tr>
                </table>
                <p style="margin-top: 1rem;">
                    Observe that <span class="math">3 + 5 = 8 ‚â° 1 (mod 7)</span> and
                    <span class="math">4 + 4 = 8 ‚â° 1 (mod 7)</span>.
                </p>
            </div>
        </section>

        <section>
            <h2>2.3 Multiplicative Inverses and Fields</h2>

            <p>
                A ring becomes a field when every nonzero element has a multiplicative inverse.
                This is the structure we need for cryptography.
            </p>

            <div class="definition">
                <p class="definition-title">Definition 2.4 (Field)</p>
                <p>
                    A <strong>field</strong> is a commutative ring <span class="math">F</span> with unity
                    <span class="math">1 ‚â† 0</span> in which every nonzero element <span class="math">a</span>
                    has a multiplicative inverse <span class="math">a‚Åª¬π</span> satisfying:
                </p>
                <p style="text-align: center; font-size: 1.1em;">
                    <span class="math">a √ó a‚Åª¬π = a‚Åª¬π √ó a = 1</span>
                </p>
            </div>

            <p>
                When does <span class="math">‚Ñ§‚Çô</span> form a field? The answer lies in the
                structure of <span class="math">n</span>.
            </p>

            <div class="theorem">
                <p class="theorem-title">Theorem 2.1 (Prime Fields)</p>
                <p>
                    <span class="math">‚Ñ§‚Çô</span> is a field if and only if <span class="math">n</span> is prime.
                </p>
            </div>

            <div class="proof">
                <p class="proof-title"></p>
                <p>
                    <em>(‚áí)</em> Suppose <span class="math">n</span> is not prime. Then
                    <span class="math">n = ab</span> for some <span class="math">1 < a, b < n</span>.
                    In <span class="math">‚Ñ§‚Çô</span>, we have <span class="math">a √ó b = n ‚â° 0</span>,
                    so <span class="math">a</span> and <span class="math">b</span> are zero divisors.
                    But a field cannot have zero divisors.
                </p>
                <p>
                    <em>(‚áê)</em> Suppose <span class="math">n = p</span> is prime. For any
                    <span class="math">a ‚â† 0</span> in <span class="math">‚Ñ§‚Çö</span>, consider the
                    function <span class="math">f: ‚Ñ§‚Çö ‚Üí ‚Ñ§‚Çö</span> defined by <span class="math">f(x) = ax</span>.
                    If <span class="math">f(x) = f(y)</span>, then <span class="math">ax ‚â° ay (mod p)</span>,
                    so <span class="math">a(x ‚àí y) ‚â° 0</span>. Since <span class="math">p</span> is
                    prime and doesn't divide <span class="math">a</span>, it must divide
                    <span class="math">x ‚àí y</span>, giving <span class="math">x = y</span>. Thus
                    <span class="math">f</span> is injective, hence bijective. In particular, there
                    exists <span class="math">b</span> with <span class="math">f(b) = 1</span>, meaning
                    <span class="math">ab ‚â° 1</span>. This <span class="math">b</span> is the multiplicative
                    inverse of <span class="math">a</span>.
                    <span class="qed"></span>
                </p>
            </div>

            <div class="definition">
                <p class="definition-title">Definition 2.5 (Prime Field)</p>
                <p>
                    For a prime <span class="math">p</span>, the field <span class="math">ùîΩ‚Çö = ‚Ñ§‚Çö</span>
                    is called the <strong>prime field</strong> of characteristic <span class="math">p</span>.
                    It contains exactly <span class="math">p</span> elements: <span class="math">{0, 1, 2, ..., p‚àí1}</span>.
                </p>
            </div>

            <figure>
                <svg class="diagram" width="500" height="200" viewBox="0 0 500 200">
                    <!-- ‚Ñ§‚ÇÜ (not a field) -->
                    <g transform="translate(50, 100)">
                        <ellipse cx="75" cy="0" rx="70" ry="60" fill="#fff8f0" stroke="#c44" stroke-width="2"/>
                        <text x="75" y="-70" text-anchor="middle" font-family="Georgia" font-size="14" font-weight="bold">‚Ñ§‚ÇÜ (not a field)</text>
                        <text x="75" y="-20" text-anchor="middle" font-family="Georgia" font-size="12">{0, 1, 2, 3, 4, 5}</text>
                        <text x="75" y="5" text-anchor="middle" font-family="Georgia" font-size="11" fill="#666">2 √ó 3 = 6 ‚â° 0</text>
                        <text x="75" y="25" text-anchor="middle" font-family="Georgia" font-size="11" fill="#c44">Zero divisors!</text>
                        <text x="75" y="50" text-anchor="middle" font-family="Georgia" font-size="11">2 has no inverse</text>
                    </g>

                    <!-- ‚Ñ§‚Çá = ùîΩ‚Çá (is a field) -->
                    <g transform="translate(300, 100)">
                        <ellipse cx="75" cy="0" rx="70" ry="60" fill="#f0f5f8" stroke="#5a8f5a" stroke-width="2"/>
                        <text x="75" y="-70" text-anchor="middle" font-family="Georgia" font-size="14" font-weight="bold">ùîΩ‚Çá (a field)</text>
                        <text x="75" y="-20" text-anchor="middle" font-family="Georgia" font-size="12">{0, 1, 2, 3, 4, 5, 6}</text>
                        <text x="75" y="5" text-anchor="middle" font-family="Georgia" font-size="11" fill="#666">7 is prime</text>
                        <text x="75" y="25" text-anchor="middle" font-family="Georgia" font-size="11" fill="#5a8f5a">Every nonzero</text>
                        <text x="75" y="45" text-anchor="middle" font-family="Georgia" font-size="11" fill="#5a8f5a">element invertible</text>
                    </g>
                </svg>
                <figcaption>Figure 2.2: ‚Ñ§‚Çô is a field exactly when n is prime.</figcaption>
            </figure>

            <div class="example">
                <p class="example-title">Example 2.3 (Multiplicative Inverses in ùîΩ‚Çá)</p>
                <p>Let us find all multiplicative inverses in <span class="math">ùîΩ‚Çá</span>:</p>
                <table>
                    <tr>
                        <th>a</th><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td>
                    </tr>
                    <tr>
                        <th>a‚Åª¬π</th><td>1</td><td>4</td><td>5</td><td>2</td><td>3</td><td>6</td>
                    </tr>
                </table>
                <p style="margin-top: 1rem;">
                    Verification: <span class="math">2 √ó 4 = 8 ‚â° 1</span>, <span class="math">3 √ó 5 = 15 ‚â° 1</span>,
                    <span class="math">6 √ó 6 = 36 ‚â° 1</span>.
                </p>
            </div>
        </section>

        <section>
            <h2>2.4 The Extended Euclidean Algorithm</h2>

            <p>
                How do we efficiently compute multiplicative inverses? The answer is one of the
                oldest algorithms in mathematics: the <em>Euclidean algorithm</em>, extended to
                find not just the greatest common divisor, but also the coefficients of B√©zout's
                identity.
            </p>

            <div class="theorem">
                <p class="theorem-title">Theorem 2.2 (B√©zout's Identity)</p>
                <p>
                    For any integers <span class="math">a</span> and <span class="math">b</span>,
                    not both zero, there exist integers <span class="math">x</span> and
                    <span class="math">y</span> such that:
                </p>
                <p style="text-align: center; font-size: 1.1em;">
                    <span class="math">ax + by = gcd(a, b)</span>
                </p>
            </div>

            <p>
                When <span class="math">gcd(a, p) = 1</span> (which is guaranteed when
                <span class="math">p</span> is prime and <span class="math">a ‚â¢ 0</span>),
                B√©zout's identity gives us:
            </p>
            <p style="text-align: center;">
                <span class="math">ax + py = 1</span>
            </p>
            <p>
                Reducing modulo <span class="math">p</span>: <span class="math">ax ‚â° 1 (mod p)</span>.
                Thus <span class="math">x</span> is the multiplicative inverse of <span class="math">a</span>!
            </p>

            <div class="definition">
                <p class="definition-title">Algorithm 2.1 (Extended Euclidean Algorithm)</p>
                <p>
                    To find <span class="math">gcd(a, b)</span> and integers <span class="math">x, y</span>
                    with <span class="math">ax + by = gcd(a, b)</span>:
                </p>
                <pre>
function extended_gcd(a, b):
    if b = 0:
        return (a, 1, 0)
    else:
        (d, x, y) = extended_gcd(b, a mod b)
        return (d, y, x - (a √∑ b) √ó y)</pre>
            </div>

            <div class="example">
                <p class="example-title">Example 2.4 (Finding 11‚Åª¬π in ùîΩ‚ÇÇ‚ÇÜ)</p>
                <p>
                    Although 26 is not prime, let us trace through the algorithm for illustration.
                    We seek <span class="math">x</span> such that <span class="math">11x ‚â° 1 (mod 26)</span>.
                </p>
                <p>Apply the Euclidean algorithm:</p>
                <table>
                    <tr><th>Step</th><th>Equation</th><th>Quotient</th></tr>
                    <tr><td>1</td><td>26 = 2 √ó 11 + 4</td><td>2</td></tr>
                    <tr><td>2</td><td>11 = 2 √ó 4 + 3</td><td>2</td></tr>
                    <tr><td>3</td><td>4 = 1 √ó 3 + 1</td><td>1</td></tr>
                    <tr><td>4</td><td>3 = 3 √ó 1 + 0</td><td>&mdash;</td></tr>
                </table>
                <p style="margin-top: 1rem;">
                    Now back-substitute:
                </p>
                <ul>
                    <li><span class="math">1 = 4 ‚àí 1 √ó 3</span></li>
                    <li><span class="math">1 = 4 ‚àí 1 √ó (11 ‚àí 2 √ó 4) = 3 √ó 4 ‚àí 1 √ó 11</span></li>
                    <li><span class="math">1 = 3 √ó (26 ‚àí 2 √ó 11) ‚àí 1 √ó 11 = 3 √ó 26 ‚àí 7 √ó 11</span></li>
                </ul>
                <p>
                    Thus <span class="math">‚àí7 √ó 11 ‚â° 1 (mod 26)</span>, giving
                    <span class="math">11‚Åª¬π ‚â° ‚àí7 ‚â° 19 (mod 26)</span>.
                </p>
                <p>Verification: <span class="math">11 √ó 19 = 209 = 8 √ó 26 + 1 ‚â° 1</span>. ‚úì</p>
            </div>

            <figure>
                <svg class="diagram" width="450" height="280" viewBox="0 0 450 280">
                    <text x="225" y="25" text-anchor="middle" font-family="Georgia" font-size="16" font-weight="bold">Extended Euclidean Algorithm</text>

                    <!-- Recursion visualization -->
                    <rect x="160" y="50" width="130" height="40" rx="5" fill="#f0f5f8" stroke="#4a90d9" stroke-width="1.5"/>
                    <text x="225" y="75" text-anchor="middle" font-family="Georgia" font-size="13">gcd(26, 11)</text>

                    <path d="M 225 90 L 225 110" stroke="#666" stroke-width="1.5" marker-end="url(#arrowGray)"/>

                    <rect x="160" y="115" width="130" height="40" rx="5" fill="#f0f5f8" stroke="#4a90d9" stroke-width="1.5"/>
                    <text x="225" y="140" text-anchor="middle" font-family="Georgia" font-size="13">gcd(11, 4)</text>

                    <path d="M 225 155 L 225 175" stroke="#666" stroke-width="1.5" marker-end="url(#arrowGray)"/>

                    <rect x="160" y="180" width="130" height="40" rx="5" fill="#f0f5f8" stroke="#4a90d9" stroke-width="1.5"/>
                    <text x="225" y="205" text-anchor="middle" font-family="Georgia" font-size="13">gcd(4, 3)</text>

                    <path d="M 225 220 L 225 240" stroke="#666" stroke-width="1.5" marker-end="url(#arrowGray)"/>

                    <rect x="160" y="245" width="130" height="25" rx="5" fill="#f8f5f0" stroke="#8b4513" stroke-width="1.5"/>
                    <text x="225" y="263" text-anchor="middle" font-family="Georgia" font-size="13">gcd(3, 1) = 1</text>

                    <!-- Coefficients on right -->
                    <text x="320" y="75" font-family="Georgia" font-size="11" fill="#666">‚Üí find x, y</text>
                    <text x="320" y="140" font-family="Georgia" font-size="11" fill="#666">‚Üí find x, y</text>
                    <text x="320" y="205" font-family="Georgia" font-size="11" fill="#666">‚Üí find x, y</text>
                    <text x="320" y="263" font-family="Georgia" font-size="11" fill="#5a8f5a">base case</text>

                    <defs>
                        <marker id="arrowGray" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
                            <polygon points="0 0, 8 3, 0 6" fill="#666"/>
                        </marker>
                    </defs>
                </svg>
                <figcaption>Figure 2.3: The extended Euclidean algorithm recursively computes B√©zout coefficients.</figcaption>
            </figure>
        </section>

        <section>
            <h2>2.5 Fermat's Little Theorem</h2>

            <p>
                An elegant alternative method for computing inverses emerges from a beautiful
                result attributed to Pierre de Fermat.
            </p>

            <div class="theorem">
                <p class="theorem-title">Theorem 2.3 (Fermat's Little Theorem)</p>
                <p>
                    Let <span class="math">p</span> be prime and <span class="math">a</span> an
                    integer not divisible by <span class="math">p</span>. Then:
                </p>
                <p style="text-align: center; font-size: 1.1em;">
                    <span class="math">a·µñ‚Åª¬π ‚â° 1 (mod p)</span>
                </p>
            </div>

            <div class="proof">
                <p class="proof-title"></p>
                <p>
                    Consider the set <span class="math">S = {a, 2a, 3a, ..., (p‚àí1)a}</span> reduced
                    modulo <span class="math">p</span>. Since <span class="math">gcd(a, p) = 1</span>,
                    multiplication by <span class="math">a</span> is a bijection on <span class="math">ùîΩ‚Çö*</span>,
                    so <span class="math">S</span> is just a permutation of <span class="math">{1, 2, ..., p‚àí1}</span>.
                </p>
                <p>
                    Taking the product of all elements in both representations:
                </p>
                <p style="text-align: center;">
                    <span class="math">a √ó 2a √ó 3a √ó ‚ãØ √ó (p‚àí1)a ‚â° 1 √ó 2 √ó 3 √ó ‚ãØ √ó (p‚àí1) (mod p)</span>
                </p>
                <p style="text-align: center;">
                    <span class="math">a·µñ‚Åª¬π √ó (p‚àí1)! ‚â° (p‚àí1)! (mod p)</span>
                </p>
                <p>
                    Since <span class="math">(p‚àí1)!</span> is not divisible by <span class="math">p</span>,
                    we may divide both sides by <span class="math">(p‚àí1)!</span>, yielding
                    <span class="math">a·µñ‚Åª¬π ‚â° 1</span>.
                    <span class="qed"></span>
                </p>
            </div>

            <p>
                An immediate corollary provides another formula for the multiplicative inverse:
            </p>

            <div class="corollary theorem">
                <p class="theorem-title">Corollary 2.1</p>
                <p>
                    For <span class="math">a ‚â¢ 0 (mod p)</span>:
                </p>
                <p style="text-align: center; font-size: 1.1em;">
                    <span class="math">a‚Åª¬π ‚â° a·µñ‚Åª¬≤ (mod p)</span>
                </p>
            </div>

            <div class="proof">
                <p class="proof-title"></p>
                <p>
                    From Fermat's theorem: <span class="math">a·µñ‚Åª¬π ‚â° 1</span>. Multiply both sides
                    by <span class="math">a‚Åª¬π</span>: <span class="math">a·µñ‚Åª¬≤ ‚â° a‚Åª¬π</span>.
                    <span class="qed"></span>
                </p>
            </div>

            <p>
                But how does one efficiently compute <span class="math">a·µñ‚Åª¬≤</span> when
                <span class="math">p</span> has 256 bits? Naively multiplying <span class="math">a</span>
                by itself <span class="math">p ‚àí 2</span> times would require approximately
                <span class="math">2¬≤‚Åµ‚Å∂</span> multiplications&mdash;utterly infeasible. The key insight
                is <em>repeated squaring</em>.
            </p>

            <div class="definition">
                <p class="definition-title">Algorithm 2.2 (Repeated Squaring)</p>
                <p>
                    To compute <span class="math">a·µè mod n</span> in <span class="math">O(log k)</span>
                    multiplications, express <span class="math">k</span> in binary and scan its bits:
                </p>
                <pre>
function power_mod(a, k, n):
    result = 1
    base = a mod n
    while k > 0:
        if k is odd:
            result = (result √ó base) mod n
        k = k √∑ 2          (integer division)
        base = (base √ó base) mod n
    return result</pre>
                <p>
                    Each iteration squares the base and conditionally multiplies into the result,
                    so the total work is proportional to the number of bits in <span class="math">k</span>.
                    For a 256-bit exponent, this requires at most 512 modular multiplications.
                </p>
            </div>

            <div class="remark">
                <p class="remark-title">Looking Ahead.</p>
                <p>
                    Repeated squaring is the multiplicative cousin of <em>double-and-add</em>, the
                    algorithm used to compute scalar multiplication on elliptic curves (Chapter 5).
                    The same principle applies: replace squaring with point doubling, and multiplication
                    with point addition.
                </p>
            </div>

            <div class="example">
                <p class="example-title">Example 2.5</p>
                <p>
                    Find <span class="math">3‚Åª¬π</span> in <span class="math">ùîΩ‚Çá</span> using
                    Fermat's theorem and repeated squaring.
                </p>
                <p>
                    By the corollary: <span class="math">3‚Åª¬π ‚â° 3‚Å∑‚Åª¬≤ = 3‚Åµ (mod 7)</span>.
                </p>
                <p>
                    Computing: <span class="math">3¬≤ = 9 ‚â° 2</span>, <span class="math">3‚Å¥ = (3¬≤)¬≤ ‚â° 2¬≤ = 4</span>,
                    <span class="math">3‚Åµ = 3‚Å¥ √ó 3 ‚â° 4 √ó 3 = 12 ‚â° 5 (mod 7)</span>.
                </p>
                <p>Verification: <span class="math">3 √ó 5 = 15 ‚â° 1 (mod 7)</span>. ‚úì</p>
            </div>

            <div class="remark">
                <p class="remark-title">Efficiency.</p>
                <p>
                    For large primes (like Bitcoin's <span class="math">p ‚âà 2¬≤‚Åµ‚Å∂</span>), the
                    extended Euclidean algorithm is typically faster than exponentiation for
                    finding inverses. However, the exponentiation method has advantages in certain
                    constant-time implementations that resist side-channel attacks.
                </p>
            </div>
        </section>

        <section>
            <h2>2.6 The Multiplicative Group ùîΩ‚Çö*</h2>

            <p>
                The nonzero elements of a prime field form a group under multiplication. This
                group has a remarkable structure.
            </p>

            <div class="definition">
                <p class="definition-title">Definition 2.6</p>
                <p>
                    The <strong>multiplicative group</strong> of <span class="math">ùîΩ‚Çö</span> is:
                </p>
                <p style="text-align: center;">
                    <span class="math">ùîΩ‚Çö* = (ùîΩ‚Çö \ {0}, √ó) = {1, 2, ..., p‚àí1}</span>
                </p>
                <p>This is a group of order <span class="math">p ‚àí 1</span>.</p>
            </div>

            <div class="theorem">
                <p class="theorem-title">Theorem 2.4</p>
                <p>
                    The multiplicative group <span class="math">ùîΩ‚Çö*</span> is cyclic.
                </p>
            </div>

            <p>
                This fundamental result means there exists a generator <span class="math">g</span>
                such that every nonzero element can be written as a power of <span class="math">g</span>.
                Such a generator is called a <strong>primitive root</strong> modulo <span class="math">p</span>.
            </p>

            <div class="example">
                <p class="example-title">Example 2.6 (Primitive Root)</p>
                <p>
                    In <span class="math">ùîΩ‚Çá*</span>, let us check if <span class="math">3</span>
                    is a primitive root:
                </p>
                <table>
                    <tr>
                        <th>k</th><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td>
                    </tr>
                    <tr>
                        <th>3·µè mod 7</th><td>3</td><td>2</td><td>6</td><td>4</td><td>5</td><td>1</td>
                    </tr>
                </table>
                <p style="margin-top: 1rem;">
                    The powers of 3 produce all six nonzero elements, so <span class="math">3</span>
                    is indeed a generator of <span class="math">ùîΩ‚Çá*</span>.
                </p>
            </div>

            <p>
                The existence of generators in <span class="math">ùîΩ‚Çö*</span> is precisely what
                enables the discrete logarithm problem to be defined in this group. When we move
                to elliptic curves, we shall see that points on the curve form a similar cyclic
                group, with a generator point playing an analogous role.
            </p>
        </section>

        <section>
            <h2>2.7 Division in Finite Fields</h2>

            <p>
                With multiplicative inverses in hand, division becomes straightforward: to compute
                <span class="math">a / b</span> in <span class="math">ùîΩ‚Çö</span>, we simply compute
                <span class="math">a √ó b‚Åª¬π</span>.
            </p>

            <div class="example">
                <p class="example-title">Example 2.7 (Division in ùîΩ‚ÇÅ‚ÇÉ)</p>
                <p>
                    Compute <span class="math">7 / 5</span> in <span class="math">ùîΩ‚ÇÅ‚ÇÉ</span>.
                </p>
                <p>
                    First find <span class="math">5‚Åª¬π</span>. Using <span class="math">5‚Åª¬π ‚â° 5¬π¬π (mod 13)</span>:
                </p>
                <ul>
                    <li><span class="math">5¬≤ = 25 ‚â° 12 ‚â° ‚àí1 (mod 13)</span></li>
                    <li><span class="math">5‚Å¥ = (5¬≤)¬≤ ‚â° 1 (mod 13)</span></li>
                    <li><span class="math">5‚Å∏ ‚â° 1 (mod 13)</span></li>
                    <li><span class="math">5¬π¬π = 5‚Å∏ √ó 5¬≤ √ó 5 ‚â° 1 √ó 12 √ó 5 = 60 ‚â° 8 (mod 13)</span></li>
                </ul>
                <p>
                    Thus <span class="math">7 / 5 = 7 √ó 8 = 56 ‚â° 4 (mod 13)</span>.
                </p>
                <p>Verification: <span class="math">4 √ó 5 = 20 ‚â° 7 (mod 13)</span>. ‚úì</p>
            </div>

            <p>
                This ability to divide (except by zero) is what distinguishes fields from mere
                rings. It is also what makes elliptic curve arithmetic possible: the formulas for
                point addition involve division, which is only well-defined in a field.
            </p>
        </section>

        <section>
            <h2>2.8 Large Primes in Cryptography</h2>

            <p>
                In practice, cryptographic systems use primes of tremendous size. Bitcoin's
                elliptic curve, secp256k1, is defined over a prime field where:
            </p>

            <p style="text-align: center; font-family: monospace; font-size: 0.9rem; word-break: break-all;">
                p = 2¬≤‚Åµ‚Å∂ ‚àí 2¬≥¬≤ ‚àí 2‚Åπ ‚àí 2‚Å∏ ‚àí 2‚Å∑ ‚àí 2‚Å∂ ‚àí 2‚Å¥ ‚àí 1
            </p>

            <p>In decimal, this is approximately:</p>

            <p style="text-align: center; font-family: monospace; font-size: 0.85rem; word-break: break-all;">
                p ‚âà 1.158 √ó 10‚Å∑‚Å∑
            </p>

            <p>
                To appreciate this magnitude: there are roughly <span class="math">10‚Å∏‚Å∞</span>
                atoms in the observable universe. The number of elements in our field is a
                substantial fraction of this cosmic count.
            </p>

            <figure>
                <svg class="diagram" width="450" height="150" viewBox="0 0 450 150">
                    <!-- Scale bar -->
                    <rect x="50" y="60" width="350" height="30" fill="none" stroke="#2f4f4f" stroke-width="2"/>

                    <!-- Gradations -->
                    <line x1="50" y1="90" x2="50" y2="100" stroke="#2f4f4f" stroke-width="1"/>
                    <text x="50" y="115" text-anchor="middle" font-family="Georgia" font-size="10">10‚Å∞</text>

                    <line x1="150" y1="90" x2="150" y2="100" stroke="#2f4f4f" stroke-width="1"/>
                    <text x="150" y="115" text-anchor="middle" font-family="Georgia" font-size="10">10¬≤‚Åµ</text>

                    <line x1="250" y1="90" x2="250" y2="100" stroke="#2f4f4f" stroke-width="1"/>
                    <text x="250" y="115" text-anchor="middle" font-family="Georgia" font-size="10">10‚Åµ‚Å∞</text>

                    <line x1="350" y1="90" x2="350" y2="100" stroke="#2f4f4f" stroke-width="1"/>
                    <text x="350" y="115" text-anchor="middle" font-family="Georgia" font-size="10">10‚Å∑‚Åµ</text>

                    <line x1="400" y1="90" x2="400" y2="100" stroke="#2f4f4f" stroke-width="1"/>
                    <text x="400" y="115" text-anchor="middle" font-family="Georgia" font-size="10">10‚Å∏‚Å∞</text>

                    <!-- Markers -->
                    <circle cx="395" cy="75" r="5" fill="#8b4513"/>
                    <text x="395" y="50" text-anchor="middle" font-family="Georgia" font-size="10" fill="#8b4513">Atoms in universe</text>

                    <circle cx="385" cy="75" r="5" fill="#4a90d9"/>
                    <text x="320" y="40" text-anchor="middle" font-family="Georgia" font-size="10" fill="#4a90d9">secp256k1 prime p</text>
                    <path d="M 350 42 L 380 70" fill="none" stroke="#4a90d9" stroke-width="1"/>

                    <text x="225" y="25" text-anchor="middle" font-family="Georgia" font-size="14" font-weight="bold">Scale of Cryptographic Primes</text>
                </svg>
                <figcaption>Figure 2.4: The prime used in Bitcoin is astronomically large.</figcaption>
            </figure>

            <div class="remark">
                <p class="remark-title">Why This Specific Prime?</p>
                <p>
                    The prime <span class="math">p = 2¬≤‚Åµ‚Å∂ ‚àí 2¬≥¬≤ ‚àí 977</span> was chosen for
                    efficiency. Its special form allows faster modular reduction than a random
                    256-bit prime. The subtracted terms are small, enabling optimized implementations.
                </p>
            </div>
        </section>

        <section class="exercises">
            <h3>Exercises</h3>

            <div class="exercise">
                <span class="exercise-number">2.1.</span>
                Compute <span class="math">17‚Åµ mod 23</span> efficiently using repeated squaring.
            </div>

            <div class="exercise">
                <span class="exercise-number">2.2.</span>
                Find the multiplicative inverse of <span class="math">17</span> in <span class="math">ùîΩ‚ÇÉ‚ÇÅ</span>
                using the extended Euclidean algorithm.
            </div>

            <div class="exercise">
                <span class="exercise-number">2.3.</span>
                Verify that <span class="math">2</span> is a primitive root modulo <span class="math">11</span>.
            </div>

            <div class="exercise">
                <span class="exercise-number">2.4.</span>
                Prove that if <span class="math">p</span> is prime and <span class="math">a¬≤ ‚â° 1 (mod p)</span>,
                then <span class="math">a ‚â° ¬±1 (mod p)</span>.
            </div>

            <div class="exercise">
                <span class="exercise-number">2.5.</span>
                Show that <span class="math">‚Ñ§‚ÇÅ‚ÇÖ</span> is not a field by finding zero divisors.
            </div>

            <div class="exercise">
                <span class="exercise-number">2.6.</span>
                <em>(Computational)</em> Implement the extended Euclidean algorithm and use it to
                find <span class="math">a‚Åª¬π mod p</span> for <span class="math">a = 12345</span>
                and <span class="math">p = 65537</span>.
            </div>

            <div class="exercise">
                <span class="exercise-number">2.7.</span>
                Prove Wilson's theorem: <span class="math">(p-1)! ‚â° -1 (mod p)</span> for any prime <span class="math">p</span>.
                <em>Hint: Pair each element with its inverse.</em>
            </div>

            <div class="exercise">
                <span class="exercise-number">2.8.</span>
                Let <span class="math">p</span> be an odd prime. How many generators does <span class="math">ùîΩ‚Çö*</span> have?
                Express your answer in terms of Euler's totient function <span class="math">œÜ(p-1)</span>.
            </div>
        </section>

        <nav class="chapter-nav">
            <a href="01-groups.html">‚Üê Chapter 1: Groups</a>
            <a href="03-elliptic-curves-real.html">Chapter 3: Elliptic Curves over ‚Ñù ‚Üí</a>
        </nav>
    </main>

    <footer>
        <p><a href="../index.html">Elementary Bitcoin</a> ¬∑ A Mathematical Introduction</p>
    </footer>
</body>
</html>
